/**
 *
 * Copyright 2014-2024 David Herron
 *
 * This file is part of AkashaCMS (http://akashacms.com/).
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
import path from 'node:path';
import { sqdb } from './sqdb.js';
class Trace {
}
export async function init() {
    await (await sqdb).run(`
    CREATE TABLE IF NOT EXISTS "TRACES" (
        \`basedir\`  TEXT,
        \`fpath\`    TEXT,
        \`fullpath\` TEXT,
        \`renderTo\` TEXT,
        \`stage\`    TEXT,
        \`start\`    TEXT
                DEFAULT(datetime('now') || 'Z'),
        \`now\`      TEXT
                DEFAULT(datetime('now') || 'Z')
    );
    CREATE INDEX "traces_basedir"
            ON "TRACES" ("basedir");
    CREATE INDEX "traces_fpath"
            ON "TRACES" ("fpath");
    CREATE INDEX "traces_fullpath"
            ON "TRACES" ("fullpath");
    `);
}
export async function report(basedir, fpath, renderTo, stage, start) {
    const trace = new Trace();
    trace.basedir = basedir;
    trace.fpath = fpath;
    trace.fullpath = path.join(basedir, fpath);
    trace.renderTo = renderTo;
    trace.stage = stage;
    trace.start = start.toISOString();
    trace.now = new Date().toISOString();
    // console.log(`data report`, trace);
    await (await sqdb).run(`
    INSERT INTO "TRACES" (
            basedir,
            fpath,
            fullpath,
            renderTo,
            stage,
            start,
            now
        )
        VALUES (
            $basedir,
            $fpath,
            $fullpath,
            $renderTo,
            $stage,
            $start,
            $now
        );
    `, {
        $basedir: trace.basedir,
        $fpath: trace.fpath,
        $fullpath: trace.fullpath,
        $renderTo: trace.renderTo,
        $stage: trace.stage,
        $start: trace.start,
        $now: trace.now
    });
}
;
/**
 * Support removing items from the saved data.  This is useful
 * when we're rendering the same file multiple times.
 *
 * @param {*} basedir
 * @param {*} fpath
 */
export async function remove(basedir, fpath) {
    try {
        await (await sqdb).run(`
            DELETE FROM "TRACES"
            WHERE
            basedir = $basedir AND fpath = $fpath
        `, {
            $basedir: basedir,
            $fpath: fpath
        });
    }
    catch (err) { }
}
;
export async function removeAll() {
    try {
        await (await sqdb).run(`
            DELETE FROM "TRACES"
        `);
    }
    catch (err) { }
}
;
export async function print() {
    const traces = await (await sqdb).all(`
        SELECT * FROM "TRACES"
        ORDER BY fullpath
    `);
    for (let trace of traces) {
        console.log(`${trace.fullpath} ${trace.renderTo} ${trace.stage} ${(new Date(trace.now).valueOf() - new Date(trace.start).valueOf()) / 1000} seconds`);
    }
}
;
export async function data4file(basedir, fpath) {
    // console.log(`data4file ${basedir} ${fpath}`);
    let ret = "";
    const traces = await (await sqdb).all(`
        SELECT * FROM "TRACES"
        WHERE 
            basedir = $basedir AND fpath = $fpath
        ORDER BY fullpath
    `, {
        $basedir: basedir,
        $fpath: fpath
    });
    for (let trace of traces) {
        if (trace.basedir === basedir && trace.fpath === fpath) {
            ret += `${trace.fullpath} ${trace.renderTo} ${trace.stage} ${(new Date(trace.now).valueOf() - new Date(trace.start).valueOf()) / 1000} seconds\n`;
        }
    }
    return ret;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS1uZXcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9saWIvZGF0YS1uZXcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHO0FBRUgsT0FBTyxJQUFJLE1BQU0sV0FBVyxDQUFDO0FBRTdCLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFHakMsTUFBTSxLQUFLO0NBUVY7QUFFRCxNQUFNLENBQUMsS0FBSyxVQUFVLElBQUk7SUFDdEIsTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7S0FrQnRCLENBQUMsQ0FBQztBQUNQLENBQUM7QUFFRCxNQUFNLENBQUMsS0FBSyxVQUFVLE1BQU0sQ0FDeEIsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQVc7SUFFNUMsTUFBTSxLQUFLLEdBQU0sSUFBSSxLQUFLLEVBQUUsQ0FBQztJQUM3QixLQUFLLENBQUMsT0FBTyxHQUFJLE9BQU8sQ0FBQztJQUN6QixLQUFLLENBQUMsS0FBSyxHQUFNLEtBQUssQ0FBQztJQUN2QixLQUFLLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzNDLEtBQUssQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzFCLEtBQUssQ0FBQyxLQUFLLEdBQU0sS0FBSyxDQUFDO0lBQ3ZCLEtBQUssQ0FBQyxLQUFLLEdBQU0sS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3JDLEtBQUssQ0FBQyxHQUFHLEdBQVEsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUMxQyxxQ0FBcUM7SUFDckMsTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0tBbUJ0QixFQUFFO1FBQ0MsUUFBUSxFQUFHLEtBQUssQ0FBQyxPQUFPO1FBQ3hCLE1BQU0sRUFBSyxLQUFLLENBQUMsS0FBSztRQUN0QixTQUFTLEVBQUUsS0FBSyxDQUFDLFFBQVE7UUFDekIsU0FBUyxFQUFFLEtBQUssQ0FBQyxRQUFRO1FBQ3pCLE1BQU0sRUFBSyxLQUFLLENBQUMsS0FBSztRQUN0QixNQUFNLEVBQUssS0FBSyxDQUFDLEtBQUs7UUFDdEIsSUFBSSxFQUFRLEtBQUssQ0FBQyxHQUFHO0tBQ3hCLENBQUMsQ0FBQztBQUNQLENBQUM7QUFBQSxDQUFDO0FBRUY7Ozs7OztHQU1HO0FBQ0gsTUFBTSxDQUFDLEtBQUssVUFBVSxNQUFNLENBQUMsT0FBTyxFQUFFLEtBQUs7SUFDdkMsSUFBSSxDQUFDO1FBQ0QsTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDOzs7O1NBSXRCLEVBQUU7WUFDQyxRQUFRLEVBQUUsT0FBTztZQUNqQixNQUFNLEVBQUksS0FBSztTQUNsQixDQUFDLENBQUM7SUFDUCxDQUFDO0lBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQyxDQUFBLENBQUM7QUFDcEIsQ0FBQztBQUFBLENBQUM7QUFFRixNQUFNLENBQUMsS0FBSyxVQUFVLFNBQVM7SUFDM0IsSUFBSSxDQUFDO1FBQ0QsTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDOztTQUV0QixDQUFDLENBQUM7SUFDUCxDQUFDO0lBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQyxDQUFBLENBQUM7QUFDcEIsQ0FBQztBQUFBLENBQUM7QUFFRixNQUFNLENBQUMsS0FBSyxVQUFVLEtBQUs7SUFDdkIsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFROzs7S0FHNUMsQ0FBQyxDQUFDO0lBRUgsS0FBSyxJQUFJLEtBQUssSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUN2QixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLFFBQVEsSUFBSSxLQUFLLENBQUMsUUFBUSxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQUcsSUFBSSxVQUFVLENBQUMsQ0FBQTtJQUN6SixDQUFDO0FBQ0wsQ0FBQztBQUFBLENBQUM7QUFFRixNQUFNLENBQUMsS0FBSyxVQUFVLFNBQVMsQ0FBQyxPQUFPLEVBQUUsS0FBSztJQUMxQyxnREFBZ0Q7SUFDaEQsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBRWIsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFROzs7OztLQUs1QyxFQUFFO1FBQ0MsUUFBUSxFQUFFLE9BQU87UUFDakIsTUFBTSxFQUFJLEtBQUs7S0FDbEIsQ0FBQyxDQUFDO0lBRUgsS0FBSyxJQUFJLEtBQUssSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUN2QixJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssT0FBTyxJQUFJLEtBQUssQ0FBQyxLQUFLLEtBQUssS0FBSyxFQUFFLENBQUM7WUFDckQsR0FBRyxJQUFJLEdBQUcsS0FBSyxDQUFDLFFBQVEsSUFBSSxLQUFLLENBQUMsUUFBUSxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQUcsSUFBSSxZQUFZLENBQUM7UUFDdEosQ0FBQztJQUNMLENBQUM7SUFDRCxPQUFPLEdBQUcsQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqXG4gKiBDb3B5cmlnaHQgMjAxNC0yMDI0IERhdmlkIEhlcnJvblxuICpcbiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIEFrYXNoYUNNUyAoaHR0cDovL2FrYXNoYWNtcy5jb20vKS5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHBhdGggZnJvbSAnbm9kZTpwYXRoJztcblxuaW1wb3J0IHsgc3FkYiB9IGZyb20gJy4vc3FkYi5qcyc7XG5pbXBvcnQgeyBBc3luY0RhdGFiYXNlIH0gZnJvbSAncHJvbWlzZWQtc3FsaXRlMyc7XG5cbmNsYXNzIFRyYWNlIHtcbiAgICBiYXNlZGlyOiBzdHJpbmc7XG4gICAgZnBhdGg6IHN0cmluZztcbiAgICBmdWxscGF0aD86IHN0cmluZztcbiAgICByZW5kZXJUbzogc3RyaW5nO1xuICAgIHN0YWdlOiBzdHJpbmc7XG4gICAgc3RhcnQ6IHN0cmluZztcbiAgICBub3c6IHN0cmluZztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgYXdhaXQgKGF3YWl0IHNxZGIpLnJ1bihgXG4gICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgXCJUUkFDRVNcIiAoXG4gICAgICAgIFxcYGJhc2VkaXJcXGAgIFRFWFQsXG4gICAgICAgIFxcYGZwYXRoXFxgICAgIFRFWFQsXG4gICAgICAgIFxcYGZ1bGxwYXRoXFxgIFRFWFQsXG4gICAgICAgIFxcYHJlbmRlclRvXFxgIFRFWFQsXG4gICAgICAgIFxcYHN0YWdlXFxgICAgIFRFWFQsXG4gICAgICAgIFxcYHN0YXJ0XFxgICAgIFRFWFRcbiAgICAgICAgICAgICAgICBERUZBVUxUKGRhdGV0aW1lKCdub3cnKSB8fCAnWicpLFxuICAgICAgICBcXGBub3dcXGAgICAgICBURVhUXG4gICAgICAgICAgICAgICAgREVGQVVMVChkYXRldGltZSgnbm93JykgfHwgJ1onKVxuICAgICk7XG4gICAgQ1JFQVRFIElOREVYIFwidHJhY2VzX2Jhc2VkaXJcIlxuICAgICAgICAgICAgT04gXCJUUkFDRVNcIiAoXCJiYXNlZGlyXCIpO1xuICAgIENSRUFURSBJTkRFWCBcInRyYWNlc19mcGF0aFwiXG4gICAgICAgICAgICBPTiBcIlRSQUNFU1wiIChcImZwYXRoXCIpO1xuICAgIENSRUFURSBJTkRFWCBcInRyYWNlc19mdWxscGF0aFwiXG4gICAgICAgICAgICBPTiBcIlRSQUNFU1wiIChcImZ1bGxwYXRoXCIpO1xuICAgIGApO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVwb3J0KFxuICAgIGJhc2VkaXIsIGZwYXRoLCByZW5kZXJUbywgc3RhZ2UsIHN0YXJ0OiBEYXRlXG4pIHtcbiAgICBjb25zdCB0cmFjZSAgICA9IG5ldyBUcmFjZSgpO1xuICAgIHRyYWNlLmJhc2VkaXIgID0gYmFzZWRpcjtcbiAgICB0cmFjZS5mcGF0aCAgICA9IGZwYXRoO1xuICAgIHRyYWNlLmZ1bGxwYXRoID0gcGF0aC5qb2luKGJhc2VkaXIsIGZwYXRoKTtcbiAgICB0cmFjZS5yZW5kZXJUbyA9IHJlbmRlclRvO1xuICAgIHRyYWNlLnN0YWdlICAgID0gc3RhZ2U7XG4gICAgdHJhY2Uuc3RhcnQgICAgPSBzdGFydC50b0lTT1N0cmluZygpO1xuICAgIHRyYWNlLm5vdyAgICAgID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIC8vIGNvbnNvbGUubG9nKGBkYXRhIHJlcG9ydGAsIHRyYWNlKTtcbiAgICBhd2FpdCAoYXdhaXQgc3FkYikucnVuKGBcbiAgICBJTlNFUlQgSU5UTyBcIlRSQUNFU1wiIChcbiAgICAgICAgICAgIGJhc2VkaXIsXG4gICAgICAgICAgICBmcGF0aCxcbiAgICAgICAgICAgIGZ1bGxwYXRoLFxuICAgICAgICAgICAgcmVuZGVyVG8sXG4gICAgICAgICAgICBzdGFnZSxcbiAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgbm93XG4gICAgICAgIClcbiAgICAgICAgVkFMVUVTIChcbiAgICAgICAgICAgICRiYXNlZGlyLFxuICAgICAgICAgICAgJGZwYXRoLFxuICAgICAgICAgICAgJGZ1bGxwYXRoLFxuICAgICAgICAgICAgJHJlbmRlclRvLFxuICAgICAgICAgICAgJHN0YWdlLFxuICAgICAgICAgICAgJHN0YXJ0LFxuICAgICAgICAgICAgJG5vd1xuICAgICAgICApO1xuICAgIGAsIHtcbiAgICAgICAgJGJhc2VkaXI6ICB0cmFjZS5iYXNlZGlyLFxuICAgICAgICAkZnBhdGg6ICAgIHRyYWNlLmZwYXRoLFxuICAgICAgICAkZnVsbHBhdGg6IHRyYWNlLmZ1bGxwYXRoLFxuICAgICAgICAkcmVuZGVyVG86IHRyYWNlLnJlbmRlclRvLFxuICAgICAgICAkc3RhZ2U6ICAgIHRyYWNlLnN0YWdlLFxuICAgICAgICAkc3RhcnQ6ICAgIHRyYWNlLnN0YXJ0LFxuICAgICAgICAkbm93OiAgICAgICB0cmFjZS5ub3dcbiAgICB9KTtcbn07XG5cbi8qKlxuICogU3VwcG9ydCByZW1vdmluZyBpdGVtcyBmcm9tIHRoZSBzYXZlZCBkYXRhLiAgVGhpcyBpcyB1c2VmdWxcbiAqIHdoZW4gd2UncmUgcmVuZGVyaW5nIHRoZSBzYW1lIGZpbGUgbXVsdGlwbGUgdGltZXMuXG4gKlxuICogQHBhcmFtIHsqfSBiYXNlZGlyXG4gKiBAcGFyYW0geyp9IGZwYXRoXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW1vdmUoYmFzZWRpciwgZnBhdGgpIHtcbiAgICB0cnkge1xuICAgICAgICBhd2FpdCAoYXdhaXQgc3FkYikucnVuKGBcbiAgICAgICAgICAgIERFTEVURSBGUk9NIFwiVFJBQ0VTXCJcbiAgICAgICAgICAgIFdIRVJFXG4gICAgICAgICAgICBiYXNlZGlyID0gJGJhc2VkaXIgQU5EIGZwYXRoID0gJGZwYXRoXG4gICAgICAgIGAsIHtcbiAgICAgICAgICAgICRiYXNlZGlyOiBiYXNlZGlyLFxuICAgICAgICAgICAgJGZwYXRoOiAgIGZwYXRoXG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge31cbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW1vdmVBbGwoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgKGF3YWl0IHNxZGIpLnJ1bihgXG4gICAgICAgICAgICBERUxFVEUgRlJPTSBcIlRSQUNFU1wiXG4gICAgICAgIGApO1xuICAgIH0gY2F0Y2ggKGVycikge31cbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcmludCgpIHtcbiAgICBjb25zdCB0cmFjZXMgPSBhd2FpdCAoYXdhaXQgc3FkYikuYWxsPFRyYWNlPihgXG4gICAgICAgIFNFTEVDVCAqIEZST00gXCJUUkFDRVNcIlxuICAgICAgICBPUkRFUiBCWSBmdWxscGF0aFxuICAgIGApO1xuXG4gICAgZm9yIChsZXQgdHJhY2Ugb2YgdHJhY2VzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAke3RyYWNlLmZ1bGxwYXRofSAke3RyYWNlLnJlbmRlclRvfSAke3RyYWNlLnN0YWdlfSAkeyhuZXcgRGF0ZSh0cmFjZS5ub3cpLnZhbHVlT2YoKSAtIG5ldyBEYXRlKHRyYWNlLnN0YXJ0KS52YWx1ZU9mKCkpIC8gMTAwMH0gc2Vjb25kc2ApXG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRhdGE0ZmlsZShiYXNlZGlyLCBmcGF0aCkge1xuICAgIC8vIGNvbnNvbGUubG9nKGBkYXRhNGZpbGUgJHtiYXNlZGlyfSAke2ZwYXRofWApO1xuICAgIGxldCByZXQgPSBcIlwiO1xuXG4gICAgY29uc3QgdHJhY2VzID0gYXdhaXQgKGF3YWl0IHNxZGIpLmFsbDxUcmFjZT4oYFxuICAgICAgICBTRUxFQ1QgKiBGUk9NIFwiVFJBQ0VTXCJcbiAgICAgICAgV0hFUkUgXG4gICAgICAgICAgICBiYXNlZGlyID0gJGJhc2VkaXIgQU5EIGZwYXRoID0gJGZwYXRoXG4gICAgICAgIE9SREVSIEJZIGZ1bGxwYXRoXG4gICAgYCwge1xuICAgICAgICAkYmFzZWRpcjogYmFzZWRpcixcbiAgICAgICAgJGZwYXRoOiAgIGZwYXRoXG4gICAgfSk7XG5cbiAgICBmb3IgKGxldCB0cmFjZSBvZiB0cmFjZXMpIHtcbiAgICAgICAgaWYgKHRyYWNlLmJhc2VkaXIgPT09IGJhc2VkaXIgJiYgdHJhY2UuZnBhdGggPT09IGZwYXRoKSB7XG4gICAgICAgICAgICByZXQgKz0gYCR7dHJhY2UuZnVsbHBhdGh9ICR7dHJhY2UucmVuZGVyVG99ICR7dHJhY2Uuc3RhZ2V9ICR7KG5ldyBEYXRlKHRyYWNlLm5vdykudmFsdWVPZigpIC0gbmV3IERhdGUodHJhY2Uuc3RhcnQpLnZhbHVlT2YoKSkgLyAxMDAwfSBzZWNvbmRzXFxuYDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmV0O1xufVxuIl19