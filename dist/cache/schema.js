/**
 *
 * Copyright 2014-2025 David Herron
 *
 * This file is part of AkashaCMS (http://akashacms.com/).
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
import path from 'node:path';
import { promises as fsp } from 'node:fs';
import Joi from "joi";
;
const joiIsPathsReturnType = Joi.object({
    vpath: Joi.string(),
    mime: Joi.string().optional().allow(null),
    mounted: Joi.string(),
    mountPoint: Joi.string(),
    pathInMounted: Joi.string(),
    mtimeMs: Joi.number(), // .integer(),
    info: Joi.any(),
    fspath: Joi.string(),
    renderPath: Joi.string()
});
export function validatePathsReturnType(obj) {
    return joiIsPathsReturnType.validate(obj);
}
;
export const joiAsset = Joi.object({
    vpath: Joi.string(),
    renderPath: Joi.string(),
    mime: Joi.string().optional().allow(null),
    mounted: Joi.string(),
    mountPoint: Joi.string(),
    pathInMounted: Joi.string(),
    fspath: Joi.string(),
    dirname: Joi.string(),
    mtimeMs: Joi.number(), // .integer(),
    info: Joi.any()
});
export function validateAsset(obj) {
    return joiAsset.validate(obj);
}
export const createAssetsTable = await fsp.readFile(path.join(import.meta.dirname, 'sql', 'create-table-assets.sql'), 'utf-8');
// This function and its siblings exist to avoid
// potential for conflict in initializing the
// variable holding the SQL and invoking
// the SQL to create the table.  By placing both
// in the same source file we ensure no conflict.
export async function doCreateAssetsTable(db) {
    await db.run(await createAssetsTable);
}
;
export const joiPartial = Joi.object({
    vpath: Joi.string(),
    renderPath: Joi.string(),
    mime: Joi.string().optional().allow(null),
    mounted: Joi.string(),
    mountPoint: Joi.string(),
    pathInMounted: Joi.string(),
    fspath: Joi.string(),
    dirname: Joi.string(),
    mtimeMs: Joi.number(), // .integer(),
    info: Joi.any(),
    // Added fields
    docBody: Joi.string().optional().allow(null),
    rendererName: Joi.string().optional().allow(null)
});
export function validatePartial(obj) {
    return joiPartial.validate(obj);
}
export const createPartialsTable = await fsp.readFile(path.join(import.meta.dirname, 'sql', 'create-table-partials.sql'), 'utf-8');
export async function doCreatePartialsTable(db) {
    await db.run(await createPartialsTable);
}
;
export const joiLayout = Joi.object({
    vpath: Joi.string(),
    renderPath: Joi.string(),
    mime: Joi.string().optional().allow(null),
    mounted: Joi.string(),
    mountPoint: Joi.string(),
    pathInMounted: Joi.string(),
    fspath: Joi.string(),
    dirname: Joi.string(),
    mtimeMs: Joi.number(), // .integer(),
    info: Joi.any(),
    // Added fields
    rendersToHTML: Joi.alternatives()
        .try(Joi.boolean(), Joi.number().integer().min(0).max(1)),
    docBody: Joi.string().optional().allow(null),
    rendererName: Joi.string().min(0).optional().allow(null)
});
export function validateLayout(obj) {
    return joiLayout.validate(obj);
}
export const createLayoutsTable = await fsp.readFile(path.join(import.meta.dirname, 'sql', 'create-table-layouts.sql'), 'utf-8');
export async function doCreateLayoutsTable(db) {
    await db.run(await createLayoutsTable);
}
;
export const joiDocument = Joi.object({
    vpath: Joi.string(),
    mime: Joi.string().optional().allow(null),
    mounted: Joi.string(),
    mountPoint: Joi.string(),
    pathInMounted: Joi.string(),
    fspath: Joi.string(),
    dirname: Joi.string(),
    mtimeMs: Joi.number(), // .integer(),
    info: Joi.any(),
    // Added fields
    renderPath: Joi.string(),
    rendersToHTML: Joi.alternatives()
        .try(Joi.boolean(), Joi.number().integer().min(0).max(1)),
    parentDir: Joi.string(),
    publicationTime: Joi.number().optional().allow(null),
    baseMetadata: Joi.any(),
    docMetadata: Joi.any(),
    docContent: Joi.string().min(0).optional().allow(null),
    docBody: Joi.string().min(0).optional().allow(null),
    metadata: Joi.any(),
    tags: Joi.any(),
    layout: Joi.alternatives()
        .try(Joi.string(), Joi.allow(null)),
    blogtag: Joi.alternatives()
        .try(Joi.string(), Joi.allow(null)),
    rendererName: Joi.string().min(0).optional().allow(null)
});
export function validateDocument(obj) {
    return joiDocument.validate(obj);
}
export const createDocumentsTable = await fsp.readFile(path.join(import.meta.dirname, 'sql', 'create-table-documents.sql'), 'utf-8');
export async function doCreateDocumentsTable(db) {
    await db.run(await createDocumentsTable);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZW1hLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vbGliL2NhY2hlL3NjaGVtYS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFFSCxPQUFPLElBQUksTUFBTSxXQUFXLENBQUM7QUFDN0IsT0FBTyxFQUFFLFFBQVEsSUFBSSxHQUFHLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDMUMsT0FBTyxHQUFHLE1BQU0sS0FBSyxDQUFDO0FBMERyQixDQUFDO0FBc0JGLE1BQU0sb0JBQW9CLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztJQUNwQyxLQUFLLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRTtJQUNuQixJQUFJLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7SUFDekMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUU7SUFDckIsVUFBVSxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUU7SUFDeEIsYUFBYSxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUU7SUFDM0IsT0FBTyxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBRSxjQUFjO0lBQ3JDLElBQUksRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFO0lBQ2YsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUU7SUFDcEIsVUFBVSxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUU7Q0FDM0IsQ0FBQyxDQUFDO0FBRUgsTUFBTSxVQUFVLHVCQUF1QixDQUFDLEdBQVE7SUFJNUMsT0FBTyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDOUMsQ0FBQztBQU1BLENBQUM7QUFTRixNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztJQUMvQixLQUFLLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRTtJQUNuQixVQUFVLEVBQUUsR0FB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QUVELE1BQU0sQ0FBQyxNQUFNLG9CQUFvQixHQUFHLE1BQU0sR0FBRyxDQUFDLFFBQVEsQ0FDOUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFDekIsS0FBSyxFQUFFLDRCQUE0QixDQUFDLEVBQ3hDLE9BQU8sQ0FDZCxDQUFDO0FBRUYsTUFBTSxDQUFDLEtBQUssVUFBVSxzQkFBc0IsQ0FDeEMsRUFBaUI7SUFFakIsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sb0JBQW9CLENBQUMsQ0FBQztBQUM3QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKlxuICogQ29weXJpZ2h0IDIwMTQtMjAyNSBEYXZpZCBIZXJyb25cbiAqXG4gKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBBa2FzaGFDTVMgKGh0dHA6Ly9ha2FzaGFjbXMuY29tLykuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCBwYXRoIGZyb20gJ25vZGU6cGF0aCc7XG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmc3AgfSBmcm9tICdub2RlOmZzJztcbmltcG9ydCBKb2kgZnJvbSBcImpvaVwiO1xuaW1wb3J0IHsgQXN5bmNEYXRhYmFzZSB9IGZyb20gJ3Byb21pc2VkLXNxbGl0ZTMnO1xuXG4vKipcbiAqIEV2ZXJ5IGNhY2hlIGVudHJ5IGhhcyB0aGVzZSBmaWVsZHMuICBGb3JcbiAqIG1vc3QgY2FjaGUgdHlwZXMsIHRoZXJlIHdpbGwgYmUgYWRkaXRpb25hbFxuICogZmllbGRzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJhc2VDYWNoZUVudHJ5IHtcblxuICAgIC8qKlxuICAgICAqIFZpcnR1YWwgcGF0aFxuICAgICAqL1xuICAgIHZwYXRoOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBNSU1FIHR5cGVcbiAgICAgKi9cbiAgICBtaW1lPzogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGZpbGUtc3lzdGVtIHBhdGggd2hpY2ggaXMgbW91bnRlZFxuICAgICAqIGludG8gdGhlIHZpcnR1YWwgZmlsZSBzcGFjZS5cbiAgICAgKi9cbiAgICBtb3VudGVkOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdmlydHVhbCBkaXJlY3Rvcnkgb2YgdGhlIG1vdW50XG4gICAgICogZW50cnkgaW4gdGhlIGRpcmVjdG9yeSBzdGFjay5cbiAgICAgKi9cbiAgICBtb3VudFBvaW50OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcmVsYXRpdmUgcGF0aCB1bmRlcm5lYXRoIHRoZSBtb3VudFBvaW50LlxuICAgICAqL1xuICAgIHBhdGhJbk1vdW50ZWQ6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIEFic29sdXRlIHBhdGggbmFtZSBpbiB0aGUgcGh5c2ljYWxcbiAgICAgKiBmaWxlc3lzdGVtLlxuICAgICAqL1xuICAgIGZzcGF0aDogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogZGlybmFtZSBmb3IgZnNwYXRoXG4gICAgICovXG4gICAgZGlybmFtZTogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG1vZGlmaWNhdGlvbiB0aW1lLCBpbiBtaWxpc2Vjb25kcy5cbiAgICAgKi9cbiAgICBtdGltZU1zOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBJbmZvIG9iamVjdCBwcm92aWRlZCBieSBTdGFja2VkRGlycyBhbmRcbiAgICAgKiBhbm5vdGF0ZWQgd2l0aCBnYXRoZXJJbmZvRGF0YVxuICAgICAqL1xuICAgIGluZm86IGFueTtcbn07XG5cbi8qKlxuICogVHlwZSBmb3IgcmV0dXJuIGZyb20gcGF0aHMgbWV0aG9kLiAgVGhlIGZpZWxkcyBoZXJlXG4gKiBhcmUgd2hhdHMgaW4gdGhlIEFzc2V0L0xheW91dC9QYXJ0aWFsIGNsYXNzZXMgYWJvdmVcbiAqIHBsdXMgYSBjb3VwbGUgZmllbGRzIHRoYXQgb2xkZXIgY29kZSBleHBlY3RlZFxuICogZnJvbSB0aGUgcGF0aHMgbWV0aG9kLlxuICovXG5leHBvcnQgdHlwZSBQYXRoc1JldHVyblR5cGUgPSB7XG4gICAgdnBhdGg6IHN0cmluZyxcbiAgICBtaW1lPzogc3RyaW5nLFxuICAgIG1vdW50ZWQ6IHN0cmluZyxcbiAgICBtb3VudFBvaW50OiBzdHJpbmcsXG4gICAgcGF0aEluTW91bnRlZDogc3RyaW5nLFxuICAgIG10aW1lTXM6IG51bWJlcixcbiAgICBpbmZvOiBhbnksXG4gICAgLy8gVGhlc2Ugd2lsbCBiZSBjb21wdXRlZCBpbiBCYXNlRmlsZUNhY2hlXG4gICAgLy8gVGhleSB3ZXJlIHJldHVybmVkIGluIHByZXZpb3VzIHZlcnNpb25zLlxuICAgIGZzcGF0aDogc3RyaW5nLFxuICAgIHJlbmRlclBhdGg6IHN0cmluZ1xufTtcblxuY29uc3Qgam9pSXNQYXRoc1JldHVyblR5cGUgPSBKb2kub2JqZWN0KHtcbiAgICB2cGF0aDogSm9pLnN0cmluZygpLFxuICAgIG1pbWU6IEpvaS5zdHJpbmcoKS5vcHRpb25hbCgpLmFsbG93KG51bGwpLFxuICAgIG1vdW50ZWQ6IEpvaS5zdHJpbmcoKSxcbiAgICBtb3VudFBvaW50OiBKb2kuc3RyaW5nKCksXG4gICAgcGF0aEluTW91bnRlZDogSm9pLnN0cmluZygpLFxuICAgIG10aW1lTXM6IEpvaS5udW1iZXIoKSwgLy8gLmludGVnZXIoKSxcbiAgICBpbmZvOiBKb2kuYW55KCksXG4gICAgZnNwYXRoOiBKb2kuc3RyaW5nKCksXG4gICAgcmVuZGVyUGF0aDogSm9pLnN0cmluZygpXG59KTtcblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUGF0aHNSZXR1cm5UeXBlKG9iajogYW55KToge1xuICAgIGVycm9yOiBhbnksXG4gICAgdmFsdWU6IFBhdGhzUmV0dXJuVHlwZVxufSB7XG4gICAgcmV0dXJuIGpvaUlzUGF0aHNSZXR1cm5UeXBlLnZhbGlkYXRlKG9iaik7XG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vIEFzc2V0XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXNzZXRGaWVsZHMge1xuXG59O1xuXG4vKipcbiAqIERlc2NyaWJlcyBhbiBlbnRyeSBpbiBhbiBBc3NldCBkaXJlY3RvcnksIG1lYW5pbmdcbiAqIHRoZSBmaWxlcyB3aGljaCBhcmUgc2ltcGx5IGNvcGllZCB0byB0aGUgb3V0cHV0XG4gKiBkaXJlY3Rvcnkgd2l0aCBubyByZW5kZXJpbmcgcHJvY2Vzcy5cbiAqL1xuZXhwb3J0IHR5cGUgQXNzZXQgPSBCYXNlQ2FjaGVFbnRyeSAmIEFzc2V0RmllbGRzO1xuXG5leHBvcnQgY29uc3Qgam9pQXNzZXQgPSBKb2kub2JqZWN0KHtcbiAgICB2cGF0aDogSm9pLnN0cmluZygpLFxuICAgIHJlbmRlclBhdGg6IEpvaS5zdHJpbmcoKSxcbiAgICBtaW1lOiBKb2kuc3RyaW5nKCkub3B0aW9uYWwoKS5hbGxvdyhudWxsKSxcbiAgICBtb3VudGVkOiBKb2kuc3RyaW5nKCksXG4gICAgbW91bnRQb2ludDogSm9pLnN0cmluZygpLFxuICAgIHBhdGhJbk1vdW50ZWQ6IEpvaS5zdHJpbmcoKSxcbiAgICBmc3BhdGg6IEpvaS5zdHJpbmcoKSxcbiAgICBkaXJuYW1lOiBKb2kuc3RyaW5nKCksXG4gICAgbXRpbWVNczogSm9pLm51bWJlcigpLCAvLyAuaW50ZWdlcigpLFxuICAgIGluZm86IEpvaS5hbnkoKVxufSk7XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUFzc2V0KG9iajogYW55KToge1xuICAgIGVycm9yOiBhbnksXG4gICAgdmFsdWU6IEFzc2V0XG59IHtcbiAgICByZXR1cm4gam9pQXNzZXQudmFsaWRhdGUob2JqKTtcbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUFzc2V0c1RhYmxlID0gYXdhaXQgZnNwLnJlYWRGaWxlKFxuICAgICAgICBwYXRoLmpvaW4oaW1wb3J0Lm1ldGEuZGlybmFtZSxcbiAgICAgICAgICAgICdzcWwnLCAnY3JlYXRlLXRhYmxlLWFzc2V0cy5zcWwnKSxcbiAgICAgICAgJ3V0Zi04J1xuKTtcblxuLy8gVGhpcyBmdW5jdGlvbiBhbmQgaXRzIHNpYmxpbmdzIGV4aXN0IHRvIGF2b2lkXG4vLyBwb3RlbnRpYWwgZm9yIGNvbmZsaWN0IGluIGluaXRpYWxpemluZyB0aGVcbi8vIHZhcmlhYmxlIGhvbGRpbmcgdGhlIFNRTCBhbmQgaW52b2tpbmdcbi8vIHRoZSBTUUwgdG8gY3JlYXRlIHRoZSB0YWJsZS4gIEJ5IHBsYWNpbmcgYm90aFxuLy8gaW4gdGhlIHNhbWUgc291cmNlIGZpbGUgd2UgZW5zdXJlIG5vIGNvbmZsaWN0LlxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRvQ3JlYXRlQXNzZXRzVGFibGUoXG4gICAgZGI6IEFzeW5jRGF0YWJhc2Vcbikge1xuICAgIGF3YWl0IGRiLnJ1bihhd2FpdCBjcmVhdGVBc3NldHNUYWJsZSk7XG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vIFBhcnRpYWxcblxuZXhwb3J0IGludGVyZmFjZSBQYXJ0aWFsRmllbGRzIHtcblxuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IGZvciB0aGUgdGVtcGxhdGUuXG4gICAgICovXG4gICAgZG9jQm9keTogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogVGhlIG5hbWUgb2YgdGhlIFJlbmRlcmVyIGNsYXNzLlxuICAgICAqIFxuICAgICAqID8/PyBUT0RPIElTIFRISVMgTkVFREVEXG4gICAgICovXG4gICAgcmVuZGVyZXJOYW1lOiBzdHJpbmc7XG59O1xuXG5leHBvcnQgdHlwZSBQYXJ0aWFsID0gQmFzZUNhY2hlRW50cnkgJiBQYXJ0aWFsRmllbGRzO1xuXG5leHBvcnQgY29uc3Qgam9pUGFydGlhbCA9IEpvaS5vYmplY3Qoe1xuICAgIHZwYXRoOiBKb2kuc3RyaW5nKCksXG4gICAgcmVuZGVyUGF0aDogSm9pLnN0cmluZygpLFxuICAgIG1pbWU6IEpvaS5zdHJpbmcoKS5vcHRpb25hbCgpLmFsbG93KG51bGwpLFxuICAgIG1vdW50ZWQ6IEpvaS5zdHJpbmcoKSxcbiAgICBtb3VudFBvaW50OiBKb2kuc3RyaW5nKCksXG4gICAgcGF0aEluTW91bnRlZDogSm9pLnN0cmluZygpLFxuICAgIGZzcGF0aDogSm9pLnN0cmluZygpLFxuICAgIGRpcm5hbWU6IEpvaS5zdHJpbmcoKSxcbiAgICBtdGltZU1zOiBKb2kubnVtYmVyKCksIC8vIC5pbnRlZ2VyKCksXG4gICAgaW5mbzogSm9pLmFueSgpLFxuXG4gICAgLy8gQWRkZWQgZmllbGRzXG4gICAgZG9jQm9keTogSm9pLnN0cmluZygpLm9wdGlvbmFsKCkuYWxsb3cobnVsbCksXG4gICAgcmVuZGVyZXJOYW1lOiBKb2kuc3RyaW5nKCkub3B0aW9uYWwoKS5hbGxvdyhudWxsKVxuXG59KTtcblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUGFydGlhbChvYmo6IGFueSk6IHtcbiAgICBlcnJvcjogYW55LFxuICAgIHZhbHVlOiBQYXJ0aWFsXG59IHtcbiAgICByZXR1cm4gam9pUGFydGlhbC52YWxpZGF0ZShvYmopO1xufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlUGFydGlhbHNUYWJsZSA9IGF3YWl0IGZzcC5yZWFkRmlsZShcbiAgICAgICAgcGF0aC5qb2luKGltcG9ydC5tZXRhLmRpcm5hbWUsXG4gICAgICAgICAgICAnc3FsJywgJ2NyZWF0ZS10YWJsZS1wYXJ0aWFscy5zcWwnKSxcbiAgICAgICAgJ3V0Zi04J1xuKTtcblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZG9DcmVhdGVQYXJ0aWFsc1RhYmxlKFxuICAgIGRiOiBBc3luY0RhdGFiYXNlXG4pIHtcbiAgICBhd2FpdCBkYi5ydW4oYXdhaXQgY3JlYXRlUGFydGlhbHNUYWJsZSk7XG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vIExheW91dFxuXG5leHBvcnQgaW50ZXJmYWNlIExheW91dEZpZWxkcyB7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgdGVtcGxhdGUgcHJvZHVjZXNcbiAgICAgKiBIVE1MLlxuICAgICAqIFxuICAgICAqID8/PyBJUyBUSElTIE5FRURFRD9cbiAgICAgKi9cbiAgICByZW5kZXJzVG9IVE1MOiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGNvbnRlbnQgZm9yIHRoZSB0ZW1wbGF0ZS5cbiAgICAgKi9cbiAgICBkb2NCb2R5OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgUmVuZGVyZXIgY2xhc3MuXG4gICAgICogXG4gICAgICogPz8/IFRPRE8gSVMgVEhJUyBORUVERURcbiAgICAgKi9cbiAgICByZW5kZXJlck5hbWU6IHN0cmluZztcbn07XG5cbmV4cG9ydCB0eXBlIExheW91dCA9IEJhc2VDYWNoZUVudHJ5ICYgTGF5b3V0RmllbGRzO1xuXG5leHBvcnQgY29uc3Qgam9pTGF5b3V0ID0gSm9pLm9iamVjdCh7XG5cbiAgICB2cGF0aDogSm9pLnN0cmluZygpLFxuICAgIHJlbmRlclBhdGg6IEpvaS5zdHJpbmcoKSxcbiAgICBtaW1lOiBKb2kuc3RyaW5nKCkub3B0aW9uYWwoKS5hbGxvdyhudWxsKSxcbiAgICBtb3VudGVkOiBKb2kuc3RyaW5nKCksXG4gICAgbW91bnRQb2ludDogSm9pLnN0cmluZygpLFxuICAgIHBhdGhJbk1vdW50ZWQ6IEpvaS5zdHJpbmcoKSxcbiAgICBmc3BhdGg6IEpvaS5zdHJpbmcoKSxcbiAgICBkaXJuYW1lOiBKb2kuc3RyaW5nKCksXG4gICAgbXRpbWVNczogSm9pLm51bWJlcigpLCAvLyAuaW50ZWdlcigpLFxuICAgIGluZm86IEpvaS5hbnkoKSxcblxuICAgIC8vIEFkZGVkIGZpZWxkc1xuICAgIHJlbmRlcnNUb0hUTUw6IEpvaS5hbHRlcm5hdGl2ZXMoKVxuICAgICAgICAudHJ5KFxuICAgICAgICAgICAgSm9pLmJvb2xlYW4oKSxcbiAgICAgICAgICAgIEpvaS5udW1iZXIoKS5pbnRlZ2VyKCkubWluKDApLm1heCgxKVxuICAgICAgICApLFxuICAgIGRvY0JvZHk6IEpvaS5zdHJpbmcoKS5vcHRpb25hbCgpLmFsbG93KG51bGwpLFxuICAgIHJlbmRlcmVyTmFtZTogSm9pLnN0cmluZygpLm1pbigwKS5vcHRpb25hbCgpLmFsbG93KG51bGwpXG5cbn0pO1xuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVMYXlvdXQob2JqOiBhbnkpOiB7XG4gICAgZXJyb3I6IGFueSxcbiAgICB2YWx1ZTogTGF5b3V0XG59IHtcbiAgICByZXR1cm4gam9pTGF5b3V0LnZhbGlkYXRlKG9iaik7XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVMYXlvdXRzVGFibGUgPSBhd2FpdCBmc3AucmVhZEZpbGUoXG4gICAgICAgIHBhdGguam9pbihpbXBvcnQubWV0YS5kaXJuYW1lLFxuICAgICAgICAgICAgJ3NxbCcsICdjcmVhdGUtdGFibGUtbGF5b3V0cy5zcWwnKSxcbiAgICAgICAgJ3V0Zi04J1xuKTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRvQ3JlYXRlTGF5b3V0c1RhYmxlKFxuICAgIGRiOiBBc3luY0RhdGFiYXNlXG4pIHtcbiAgICBhd2FpdCBkYi5ydW4oYXdhaXQgY3JlYXRlTGF5b3V0c1RhYmxlKTtcbn1cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8gRG9jdW1lbnRcblxuZXhwb3J0IGludGVyZmFjZSBEb2N1bWVudEZpZWxkcyB7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdmlydHVhbCBwYXRobmFtZSB0byB3aGljaCB0aGlzXG4gICAgICogZG9jdW1lbnQgcmVuZGVycyBpbiB0aGUgb3V0cHV0IGRpcmVjdG9yeS5cbiAgICAgKi9cbiAgICByZW5kZXJQYXRoOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgdGVtcGxhdGUgcHJvZHVjZXNcbiAgICAgKiBIVE1MLlxuICAgICAqIFxuICAgICAqID8/PyBJUyBUSElTIE5FRURFRD9cbiAgICAgKi9cbiAgICByZW5kZXJzVG9IVE1MOiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHZpcnR1YWwgcGF0aG5hbWUgdGhhdCBpcyB0aGVcbiAgICAgKiBkaXJlY3RvcnkgbmFtZSBvZiB0aGUgcmVuZGVyUGF0aC5cbiAgICAgKi9cbiAgICAvLyBJTiBCQVNFIENBQ0hFIGRpcm5hbWU6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRoZSB2aXJ0dWFsIHBhdGhuYW1lIHRoYXQgaXMgdGhlXG4gICAgICogcGFyZW50IGRpcmVjdG9yeSBuYW1lIG9mIGRpcm5hbWUuXG4gICAgICogXG4gICAgICogPz8/Pz8gSVMgVEhJUyBORUVERURcbiAgICAgKi9cbiAgICBwYXJlbnREaXI6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRoZSBcInRpbWVcIiAoc2Vjb25kcyBzaW5jZSBKYW4gMSAxOTcwKVxuICAgICAqIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHB1YmxpY2F0aW9uRGF0ZVxuICAgICAqIGZpZWxkIGluIHRoZSBkb2N1bWVudCBtZXRhZGF0YS5cbiAgICAgKiBcbiAgICAgKiBJTlRFR0VSIEdFTkVSQVRFRCBBTFdBWVNcbiAgICAgKiAgQVMgKGpzb25fZXh0cmFjdChpbmZvLCAnJC5wdWJsaWNhdGlvblRpbWUnKSkgU1RPUkVEXG4gICAgICovXG4gICAgcHVibGljYXRpb25UaW1lOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdmFsdWUgZm9yIHRoZSBiYXNlTWV0YWRhdGEgb2ZcbiAgICAgKiB0aGUgbW91bnRlZCB2aXJ0dWFsIGRpcmVjdG9yeSBpblxuICAgICAqIHdoaWNoIHRoaXMgZmlsZSBpcyBzdG9yZWQuICBUaGlzXG4gICAgICogbWV0YWRhdGEgaXMgdXNlZCBpbiBjb21wdXRpbmcgdGhlXG4gICAgICogZmluYWwgbWV0YWRhdGEuXG4gICAgICogXG4gICAgICogVEVYVCBHRU5FUkFURUQgQUxXQVlTXG4gICAgICogIEFTIChqc29uX2V4dHJhY3QoaW5mbywgJyQuYmFzZU1ldGFkYXRhJykpIFNUT1JFRFxuICAgICAqL1xuICAgIGJhc2VNZXRhZGF0YTogYW55O1xuXG4gICAgLyoqXG4gICAgICogVGhlIHZhbHVlIGZvciB0aGUgaGVhZGVyIG1ldGFkYXRhIG9mXG4gICAgICogdGhlIGRvY3VtZW50LiAgVGhpcyBtZXRhZGF0YSBpcyB1c2VkLFxuICAgICAqIGFsb25nIHdpdGggZG9jTWV0YWRhdGEsIGluIGNvbXB1dGluZyB0aGVcbiAgICAgKiBmaW5hbCBtZXRhZGF0YS5cbiAgICAgKi9cbiAgICBkb2NNZXRhZGF0YTogYW55O1xuXG4gICAgLyoqXG4gICAgICogVGhlIGNvbnRlbnQgZm9yIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICBkb2NDb250ZW50OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYm9keSBwb3J0aW9uIG9mIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICBkb2NCb2R5OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZmluYWwgbWV0YWRhdGEgZm9yIHRoZSBkb2N1bWVudCxcbiAgICAgKiB3aGljaCBpcyBjb21wdXRlZCBmcm9tIGJhc2VNZXRhZGF0YVxuICAgICAqIGFuZCBkb2NNZXRhZGF0YS5cbiAgICAgKiBcbiAgICAgKiBURVhUIEdFTkVSQVRFRCBBTFdBWVNcbiAgICAgKiAgQVMgKGpzb25fZXh0cmFjdChpbmZvLCAnJC5tZXRhZGF0YScpKSBTVE9SRURcbiAgICAgKi9cbiAgICBtZXRhZGF0YTogYW55O1xuXG4gICAgLyoqXG4gICAgICogVGhlIGFycmF5IG9mIHRhZyBzdHJpbmdzIGRlcml2ZWQgZnJvbVxuICAgICAqIHRoZSB0YWdzIGZpZWxkIG9mIHRoZSBkb2N1bWVudCBtZXRhZGF0YS5cbiAgICAgKiBcbiAgICAgKiBURVhUIEdFTkVSQVRFRCBBTFdBWVNcbiAgICAgKiAgQVMgKGpzb25fZXh0cmFjdChpbmZvLCAnJC5tZXRhZGF0YS50YWdzJykpIFNUT1JFRFxuICAgICAqL1xuICAgIHRhZ3M6IGFueTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IG9mIHRoZSBsYXlvdXQgZmllbGRcbiAgICAgKiBvZiB0aGUgZG9jdW1lbnQgbWV0YWRhdGEuXG4gICAgICogXG4gICAgICogVEVYVCBHRU5FUkFURUQgQUxXQVlTXG4gICAgICogIEFTIChqc29uX2V4dHJhY3QobWV0YWRhdGEsICckLmxheW91dCcpKSBTVE9SRURcbiAgICAgKi9cbiAgICBsYXlvdXQ6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IG9mIHRoZSBibG9ndGFnIGZpZWxkXG4gICAgICogb2YgdGhlIGRvY3VtZW50IG1ldGFkYXRhLlxuICAgICAqIFxuICAgICAqIFRFWFQgR0VORVJBVEVEIEFMV0FZU1xuICAgICAqICBBUyAoanNvbl9leHRyYWN0KG1ldGFkYXRhLCAnJC5ibG9ndGFnJykpIFNUT1JFRFxuICAgICAqL1xuICAgIGJsb2d0YWc6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRoZSBuYW1lIG9mIHRoZSBSZW5kZXJlciBjbGFzcy5cbiAgICAgKiBcbiAgICAgKiA/Pz8gVE9ETyBJUyBUSElTIE5FRURFRFxuICAgICAqL1xuICAgIHJlbmRlcmVyTmFtZTogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgRG9jdW1lbnQgPSBCYXNlQ2FjaGVFbnRyeVxuICAgICAgICAgICAgICAgICAgICAgJiBEb2N1bWVudEZpZWxkcztcblxuZXhwb3J0IGNvbnN0IGpvaURvY3VtZW50ID0gSm9pLm9iamVjdCh7XG5cbiAgICB2cGF0aDogSm9pLnN0cmluZygpLFxuICAgIG1pbWU6IEpvaS5zdHJpbmcoKS5vcHRpb25hbCgpLmFsbG93KG51bGwpLFxuICAgIG1vdW50ZWQ6IEpvaS5zdHJpbmcoKSxcbiAgICBtb3VudFBvaW50OiBKb2kuc3RyaW5nKCksXG4gICAgcGF0aEluTW91bnRlZDogSm9pLnN0cmluZygpLFxuICAgIGZzcGF0aDogSm9pLnN0cmluZygpLFxuICAgIGRpcm5hbWU6IEpvaS5zdHJpbmcoKSxcbiAgICBtdGltZU1zOiBKb2kubnVtYmVyKCksIC8vIC5pbnRlZ2VyKCksXG4gICAgaW5mbzogSm9pLmFueSgpLFxuXG4gICAgLy8gQWRkZWQgZmllbGRzXG4gICAgcmVuZGVyUGF0aDogSm9pLnN0cmluZygpLFxuICAgIHJlbmRlcnNUb0hUTUw6IEpvaS5hbHRlcm5hdGl2ZXMoKVxuICAgICAgICAudHJ5KFxuICAgICAgICAgICAgSm9pLmJvb2xlYW4oKSxcbiAgICAgICAgICAgIEpvaS5udW1iZXIoKS5pbnRlZ2VyKCkubWluKDApLm1heCgxKVxuICAgICAgICApLFxuICAgIHBhcmVudERpcjogSm9pLnN0cmluZygpLFxuICAgIHB1YmxpY2F0aW9uVGltZTogSm9pLm51bWJlcigpLm9wdGlvbmFsKCkuYWxsb3cobnVsbCksXG4gICAgYmFzZU1ldGFkYXRhOiBKb2kuYW55KCksXG4gICAgZG9jTWV0YWRhdGE6IEpvaS5hbnkoKSxcbiAgICBkb2NDb250ZW50OiBKb2kuc3RyaW5nKCkubWluKDApLm9wdGlvbmFsKCkuYWxsb3cobnVsbCksXG4gICAgZG9jQm9keTogSm9pLnN0cmluZygpLm1pbigwKS5vcHRpb25hbCgpLmFsbG93KG51bGwpLFxuICAgIG1ldGFkYXRhOiBKb2kuYW55KCksXG4gICAgdGFnczogSm9pLmFueSgpLFxuICAgIGxheW91dDogSm9pLmFsdGVybmF0aXZlcygpXG4gICAgICAgIC50cnkoXG4gICAgICAgICAgICBKb2kuc3RyaW5nKCksXG4gICAgICAgICAgICBKb2kuYWxsb3cobnVsbClcbiAgICAgICAgKSxcbiAgICBibG9ndGFnOiBKb2kuYWx0ZXJuYXRpdmVzKClcbiAgICAgICAgLnRyeShcbiAgICAgICAgICAgIEpvaS5zdHJpbmcoKSxcbiAgICAgICAgICAgIEpvaS5hbGxvdyhudWxsKVxuICAgICAgICApLFxuICAgIHJlbmRlcmVyTmFtZTogSm9pLnN0cmluZygpLm1pbigwKS5vcHRpb25hbCgpLmFsbG93KG51bGwpXG5cbn0pO1xuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVEb2N1bWVudChvYmo6IGFueSk6IHtcbiAgICBlcnJvcjogYW55LFxuICAgIHZhbHVlOiBEb2N1bWVudFxufSB7XG4gICAgcmV0dXJuIGpvaURvY3VtZW50LnZhbGlkYXRlKG9iaik7XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVEb2N1bWVudHNUYWJsZSA9IGF3YWl0IGZzcC5yZWFkRmlsZShcbiAgICAgICAgcGF0aC5qb2luKGltcG9ydC5tZXRhLmRpcm5hbWUsXG4gICAgICAgICAgICAnc3FsJywgJ2NyZWF0ZS10YWJsZS1kb2N1bWVudHMuc3FsJyksXG4gICAgICAgICd1dGYtOCdcbik7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkb0NyZWF0ZURvY3VtZW50c1RhYmxlKFxuICAgIGRiOiBBc3luY0RhdGFiYXNlXG4pIHtcbiAgICBhd2FpdCBkYi5ydW4oYXdhaXQgY3JlYXRlRG9jdW1lbnRzVGFibGUpO1xufSJdfQ==